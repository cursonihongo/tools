<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="styles.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.bunny.net">
  <link href="https://fonts.bunny.net/css?family=m-plus-1:100,200,300,400,500,600,700,800,900" rel="stylesheet" />

  <title>Quiz de Hiragana — NihonGO</title>
</head>
<body>

<header>
  <a href="https://cursonihongo.com" target="_blank"><img class="logo" src="logo-nihongo.svg" alt="NihonGO"></a>
  <h1>Quiz de Hiragana</h1>
</header>

<main>

  <div class="status">
    <div id="progress-wrap"><div id="progress-bar"></div></div>
    <div id="counter"></div>
  </div>

  <div id="quiz-area"></div>
  <button id="next" disabled>Próximo</button>

  <div id="summary"></div>

</main>

<script>
document.addEventListener('DOMContentLoaded', () => {

  /* --------- REFERENCE TABLE --------- */
  const hiragana = [
    /* Basic */
    ['あ','A'],['い','I'],['う','U'],['え','E'],['お','O'],
    ['か','KA'],['き','KI'],['く','KU'],['け','KE'],['こ','KO'],
    ['さ','SA'],['し','SHI'],['す','SU'],['せ','SE'],['そ','SO'],
    ['た','TA'],['ち','CHI'],['つ','TSU'],['て','TE'],['と','TO'],
    ['な','NA'],['に','NI'],['ぬ','NU'],['ね','NE'],['の','NO'],
    ['は','HA'],['ひ','HI'],['ふ','FU'],['へ','HE'],['ほ','HO'],
    ['ま','MA'],['み','MI'],['む','MU'],['め','ME'],['も','MO'],
    ['や','YA'],            ['ゆ','YU'],            ['よ','YO'],
    ['ら','RA'],['り','RI'],['る','RU'],['れ','RE'],['ろ','RO'],
    ['わ','WA'],['を','WO'],['ん','N'],
    /* Dakuten */
    ['が','GA'],['ぎ','GI'],['ぐ','GU'],['げ','GE'],['ご','GO'],
    ['ざ','ZA'],['じ','JI'],['ず','ZU'],['ぜ','ZE'],['ぞ','ZO'],
    ['だ','DA'],['ぢ','JI'],['づ','DZU'],['で','DE'],['ど','DO'],
    ['ば','BA'],['び','BI'],['ぶ','BU'],['べ','BE'],['ぼ','BO'],
    /* Handakuten */
    ['ぱ','PA'],['ぴ','PI'],['ぷ','PU'],['ぺ','PE'],['ぽ','PO'],
    /* Yōon */
    ['きゃ','KYA'],['きゅ','KYU'],['きょ','KYO'],
    ['しゃ','SHA'],['しゅ','SHU'],['しょ','SHO'],
    ['ちゃ','CHA'],['ちゅ','CHU'],['ちょ','CHO'],
    ['にゃ','NYA'],['にゅ','NYU'],['にょ','NYO'],
    ['ひゃ','HYA'],['ひゅ','HYU'],['ひょ','HYO'],
    ['みゃ','MYA'],['みゅ','MYU'],['みょ','MYO'],
    ['りゃ','RYA'],['りゅ','RYU'],['りょ','RYO'],
    ['ぎゃ','GYA'],['ぎゅ','GYU'],['ぎょ','GYO'],
    ['じゃ','JA'],['じゅ','JU'],['じょ','JO'],
    ['びゃ','BYA'],['びゅ','BYU'],['びょ','BYO'],
    ['ぴゃ','PYA'],['ぴゅ','PYU'],['ぴょ','PYO']
  ];

  /* --------- ELEMENTS --------- */
  const quizArea        = document.getElementById('quiz-area');
  const nextButton      = document.getElementById('next');
  const progressBar     = document.getElementById('progress-bar');
  const questionCounter = document.getElementById('counter');
  const questionSummary = document.getElementById('summary');

  /* --------- UTILITIES --------- */
  const shuffle = a => [...a].sort(()=>Math.random()-0.5);

  /* --------- STATES --------- */
  const questions   = shuffle(hiragana); // Random order
  const total       = questions.length;  // 104
  let questionIndex = 0;                 // Current question
  let rightAnswers  = 0;                 // Right answers
  const answers     = [];                // For the final summary

  /* --------- ANSWER GENERATOR --------- */
  const generateQuestions = correct => {
    const distractors = shuffle(
      hiragana.filter(p=>p[1]!==correct)
    ).slice(0,4).map(p=>p[1]);
    return shuffle([correct, ...distractors]);
  };

  /* --------- QUESTION RENDERER --------- */
  function showQuestion() {
    const [kana, romaji] = questions[questionIndex];
    const answers = generateQuestions(romaji);

    quizArea.innerHTML = `
      <div class="question">${kana}</div>
      <div class="answers">
        ${answers.map((alt,i)=>`
          <label class="answers__item">
            <input type="radio" name="answer" value="${alt}">
            ${alt}
          </label>`).join('')}
      </div>
    `;

    // Update progress bar and counter
    const perc = ((questionIndex)/total)*100;
    progressBar.style.width = perc + '%';
    questionCounter.textContent = `${questionIndex+1} / ${total}`;

    // Disables button until selection
    nextButton.disabled = true;

    // Listener for enabling button when selection is made
    quizArea.querySelectorAll('input').forEach(inp=>{
      inp.addEventListener('change',()=> nextButton.disabled = false);
    });

    // Button Text
    nextButton.textContent = (questionIndex === total-1) ? 'Finalizar' : 'Próxima';
  }

  /* --------- Next Answer --------- */
  nextButton.addEventListener('click', ()=> {
    const answerSelection = quizArea.querySelector('input:checked');
    if(!answerSelection) return; // For safety
    const selectedAnswer = answerSelection.value;
    const [kana, correct] = questions[questionIndex];

    const rightAnswer = (selectedAnswer === correct);
    if(rightAnswer) rightAnswers++;

    answers.push({kana, correct, selectedAnswer, rightAnswer});

    questionIndex++;
    if(questionIndex < total){
      showQuestion();
    }else{
      showResults();
    }
  });

  /* --------- RESULTS --------- */
  function showResults(){
    // Full progress bar
    progressBar.style.width = '100%';
    questionCounter.textContent = `${total} / ${total}`;
    quizArea.innerHTML = '';
    quizArea.style.display = 'none';
    nextButton.style.display = 'none';

    questionSummary.innerHTML =
      `<p class="result">Você acertou ${rightAnswers} de ${total} questões.</p>`;

    /* ---- Summary ---- */
    const details = document.createElement('div');
    details.classList.add('summary__answers');
    answers.forEach(r=>{
      const div = document.createElement('div');
      div.className = `summary__item ${r.rightAnswer?'correct':'incorrect'}`;
      div.innerHTML = `
        <div class="question">${r.kana}</div>
        <div>
          Sua resposta: <strong>${r.selectedAnswer || '—'}</strong><br>
          Resposta correta: <strong>${r.correct}</strong>
        </div>`;
      details.appendChild(div);
    });
    questionSummary.appendChild(details);
  }

  /* --------- BEGIN --------- */
  showQuestion();

});
</script>
</body>
</html>
