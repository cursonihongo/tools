<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="styles.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.bunny.net">
  <link href="https://fonts.bunny.net/css?family=m-plus-1:100,200,300,400,500,600,700,800,900" rel="stylesheet" />

  <title>Quiz de Katakana — NihonGO</title>
</head>
<body>

<header>
  <a href="https://cursonihongo.com" target="_blank"><img class="logo" src="logo-nihongo.svg" alt="NihonGO"></a>
  <h1>Quiz de Katakana</h1>
</header>

<main>

  <div class="status">
    <div id="progress-wrap"><div id="progress-bar"></div></div>
    <div id="counter"></div>
  </div>

  <div id="quiz-area"></div>
  <button id="next" disabled>Próximo</button>

  <div id="summary"></div>

</main>

<script>
document.addEventListener('DOMContentLoaded', () => {

  /* --------- REFERENCE TABLE --------- */
  const kana = [
    /* Basic */
    ['ア','A'],['イ','I'],['ウ','U'],['エ','E'],['オ','O'],
    ['カ','KA'],['キ','KI'],['ク','KU'],['ケ','KE'],['コ','KO'],
    ['サ','SA'],['シ','SHI'],['ス','SU'],['セ','SE'],['ソ','SO'],
    ['タ','TA'],['チ','CHI'],['ツ','TSU'],['テ','TE'],['ト','TO'],
    ['ナ','NA'],['ニ','NI'],['ヌ','NU'],['ネ','NE'],['ノ','NO'],
    ['ハ','HA'],['ヒ','HI'],['フ','FU'],['ヘ','HE'],['ホ','HO'],
    ['マ','MA'],['ミ','MI'],['ム','MU'],['メ','ME'],['モ','MO'],
    ['ヤ','YA'],            ['ユ','YU'],            ['ヨ','YO'],
    ['ラ','RA'],['リ','RI'],['ル','RU'],['レ','RE'],['ロ','RO'],
    ['ワ','WA'],['ヲ','WO'],['ン','N'],
    /* Dakuten */
    ['ガ','GA'],['ギ','GI'],['グ','GU'],['ゲ','GE'],['ゴ','GO'],
    ['ザ','ZA'],['ジ','JI'],['ズ','ZU'],['ゼ','ZE'],['ゾ','ZO'],
    ['ダ','DA'],['ヂ','JI'],['ヅ','DZU'],['デ','DE'],['ド','DO'],
    ['バ','BA'],['ビ','BI'],['ブ','BU'],['ベ','BE'],['ボ','BO'],
    /* Handakuten */
    ['パ','PA'],['ピ','PI'],['プ','PU'],['ペ','PE'],['ポ','PO'],
    /* Yōon */
    ['キャ','KYA'],['キュ','KYU'],['キョ','KYO'],
    ['シャ','SHA'],['シュ','SHU'],['シェ','SHE'],['ショ','SHO'],
    ['チャ','CHA'],['チュ','CHU'],['チェ','CHE'],['チョ','CHO'],
    ['ニャ','NYA'],['ニュ','NYU'],['ニョ','NYO'],
    ['ヒャ','HYA'],['ヒュ','HYU'],['ヒョ','HYO'],
    ['ミャ','MYA'],['ミュ','MYU'],['ミョ','MYO'],
    ['リャ','RYA'],['リュ','RYU'],['リョ','RYO'],
    ['ギャ','GYA'],['ギュ','GYU'],['ギョ','GYO'],
    ['ジャ','JA'],['ジュ','JU'],['ジェ','JE'],['ジョ','JO'],
    ['ビャ','BYA'],['ビュ','BYU'],['ビョ','BYO'],
    ['ピャ','PYA'],['ピュ','PYU'],['ピョ','PYO'],
    ['ヴァ','VA'],['ヴィ','VI'],['ヴ','VU'],['ヴェ','VE'],['ヴォ','VO'],
    ['ファ','FA'],['フィ','FI'],['フ','FU'],['フェ','FE'],['フォ','FO'],
    ['トゥ','TU'],['ドゥ','DU'],
    ['ティ','TI'],['ディ','DI'],
    ['ウィ','WI'],['ウェ','WE'],['ウォ','WO']
  ];

  /* --------- ELEMENTS --------- */
  const quizArea        = document.getElementById('quiz-area');
  const nextButton      = document.getElementById('next');
  const progressBar     = document.getElementById('progress-bar');
  const questionCounter = document.getElementById('counter');
  const questionSummary = document.getElementById('summary');

  /* --------- UTILITIES --------- */
  const shuffle = a => [...a].sort(()=>Math.random()-0.5);

  /* --------- STATES --------- */
  const questions   = shuffle(kana); // Random order
  const total       = questions.length;  // 104
  let questionIndex = 0;                 // Current question
  let rightAnswers  = 0;                 // Right answers
  const answers     = [];                // For the final summary

  /* --------- ANSWER GENERATOR --------- */
  const generateQuestions = correct => {
    const distractors = shuffle(
      kana.filter(p=>p[1]!==correct)
    ).slice(0,4).map(p=>p[1]);
    return shuffle([correct, ...distractors]);
  };

  /* --------- QUESTION RENDERER --------- */
  function showQuestion() {
    const [kana, romaji] = questions[questionIndex];
    const answers = generateQuestions(romaji);

    quizArea.innerHTML = `
      <div class="question">${kana}</div>
      <div class="answers">
        ${answers.map((alt,i)=>`
          <label class="answers__item">
            <input type="radio" name="answer" value="${alt}">
            ${alt}
          </label>`).join('')}
      </div>
    `;

    // Update progress bar and counter
    const perc = ((questionIndex)/total)*100;
    progressBar.style.width = perc + '%';
    questionCounter.textContent = `${questionIndex+1} / ${total}`;

    // Disables button until selection
    nextButton.disabled = true;

    // Listener for enabling button when selection is made
    quizArea.querySelectorAll('input').forEach(inp=>{
      inp.addEventListener('change',()=> nextButton.disabled = false);
    });

    // Button Text
    nextButton.textContent = (questionIndex === total-1) ? 'Finalizar' : 'Próxima';
  }

  /* --------- Next Answer --------- */
  nextButton.addEventListener('click', ()=> {
    const answerSelection = quizArea.querySelector('input:checked');
    if(!answerSelection) return; // For safety
    const selectedAnswer = answerSelection.value;
    const [kana, correct] = questions[questionIndex];

    const rightAnswer = (selectedAnswer === correct);
    if(rightAnswer) rightAnswers++;

    answers.push({kana, correct, selectedAnswer, rightAnswer});

    questionIndex++;
    if(questionIndex < total){
      showQuestion();
    }else{
      showResults();
    }
  });

  /* --------- RESULTS --------- */
  function showResults(){
    // Full progress bar
    progressBar.style.width = '100%';
    questionCounter.textContent = `${total} / ${total}`;
    quizArea.innerHTML = '';
    quizArea.style.display = 'none';
    nextButton.style.display = 'none';

    questionSummary.innerHTML =
      `<p class="result">Você acertou ${rightAnswers} de ${total} questões.</p>`;

    /* ---- Summary ---- */
    const details = document.createElement('div');
    details.classList.add('summary__answers');
    answers.forEach(r=>{
      const div = document.createElement('div');
      div.className = `summary__item ${r.rightAnswer?'correct':'incorrect'}`;
      div.innerHTML = `
        <div class="question">${r.kana}</div>
        <div>
          Sua resposta: <strong>${r.selectedAnswer || '—'}</strong><br>
          Resposta correta: <strong>${r.correct}</strong>
        </div>`;
      details.appendChild(div);
    });
    questionSummary.appendChild(details);
  }

  /* --------- BEGIN --------- */
  showQuestion();

});
</script>
</body>
</html>
